on_death = {
	on_actions = {
		on_death_republic
		on_death_governor
	}
}

on_death_republic = {
	effect = {
		save_scope_as = dying_person
		if = {
			limit = {
				exists = house
				is_house_head = yes
			}
			house = {
				clear_variable_list = propoganda_campaigns_list
				clear_variable_list = smear_campaigns_list
			}
		}
		if = {
			limit = {
				exists = house
				house = {
					exists = var:titular_republic
					var:titular_republic = {
						holder = {
							republic_has_council_form = yes
						}
					}
					exists = var:republic_councillor
				}
			}
			house = {
				var:titular_republic = {
					republic_council_succesion = yes
				}
			}
		}
	}
}

yearly_global_pulse = {
	on_actions = {
		yearly_republic_check
	}
}

yearly_republic_check = {
	effect = {
		every_valid_republic_holder = {
			limit = { is_independent_ruler = yes republic_has_bicameral_form = yes }
			var:republic_head = {
				clear_variable_list = lower_house_counties
				generate_counties_for_lower_house = yes
			}
		}
		every_republic_holder = {
			limit = { OR = { highest_held_title_tier < tier_duchy is_independent_ruler = no } }
			var:republic_head = {
				every_in_list = { variable = republic_Families_list house_head = { trigger_event = merchant_republic_events.1010 } }
			}
			end_story = var:republic_head
		}
		every_patrician = {
			limit = { is_courtier = yes NOT = { employer = house.var:titular_republic.var:republic_owner } }
			set_employer = house.var:titular_republic.var:republic_owner
		}
		if = {
			limit = { NAND = { has_global_variable_list = council_laws_list has_global_variable_list = senate_laws_list has_global_variable_list = elected_ruler_laws_list } }
			all_council_laws = yes
			all_senate_laws = yes
			all_elected_ruler_laws = yes
			all_bicameral_laws = yes
		}
		every_living_character = {
			limit = {
				exists = house
				is_house_head = yes
				house = {
					OR = {
						has_variable_list = smear_campaigns_list
						has_variable_list = propoganda_campaigns_list
					}
				}
				NAND = { exists = house.var:titular_republic }
			}
			house = {
				clear_variable_list = smear_campaigns_list
				clear_variable_list = propoganda_campaigns_list
			}
		}
		every_living_character = {
			limit = {
				exists = house
				house.house_head = this
				NAND = {
					has_trait = devoted
					has_government = governor_government
					has_government = theocracy_government
				}
				NOT = { exists = house.var:titular_republic  }
				exists = liege_or_court_owner.var:republic_head
				OR = {
					NOT = { liege_or_court_owner = { republic_has_bicameral_form = yes } }
					culture = liege_or_court_owner.culture
					liege_or_court_owner.house.var:titular_republic = { exists = var:all_cultures_citizenship }
					AND = {
						exists = liege_or_court_owner.house.var:titular_republic.var:same_culture_group_citizenship
						culture = { has_same_culture_heritage = prev.liege_or_court_owner.culture }
					}
				}
				OR = {
					NOT = { liege_or_court_owner = { republic_has_bicameral_form = yes } }
					faith = liege_or_court_owner.faith
					liege_or_court_owner.house.var:titular_republic = { exists = var:all_religions_citizenship }
					AND = {
						exists = liege_or_court_owner.house.var:titular_republic.var:same_religion_group_citizenship
						religion = liege_or_court_owner.religion
					}
				}

			}
			add_family_to_republic_families = yes
			trigger_event = {
				id = merchant_republic_events.1001
				days = { 0 50 }
			}
		}
		every_valid_republic_holder = {
			var:republic_head = {
				every_in_list = {
					variable = republic_families_list
					limit = {
						OR = {
							NOT = { exists = house_head }
							AND = {
								house_head = {
									holds_valid_merchant_republic = no
									OR = {
										NOT = { exists = liege_or_court_owner }
										NOT = { liege_or_court_owner = { holds_valid_merchant_republic = yes } } 
									}
								}
							}
							AND = { house_head = { is_landed = yes has_government = theocracy_government } }
						}
					}
					house_head = { remove_family_from_republic = yes }
				}
				if = {
					limit = {
						any_in_list = {
							variable = proposed_laws_list
							exists = this
						}
						holder = {
							republic_has_senate_form = yes
						}
					}
					trigger_election_cycle = yes
				}
				if = {
					limit = {
						any_in_list = {
							variable = proposed_laws_list
							exists = this
						}
						holder = {
							republic_has_council_form = yes
						}
					}
					trigger_council_election_cycle = yes
				}
				if = {
					limit = {
						any_in_list = {
							variable = proposed_laws_list
							exists = this
						}
						holder = {
							republic_has_bicameral_form = yes
						}
					}
					bicameral_laws_voting = yes
				}
			}
		}
		every_valid_republic_holder = {
			limit = { republic_has_council_form = yes }
			var:republic_head = {
				change_appeasement_positive = { CLASS = nobility   AMOUNT = nobility_appeasement_yearly_change }
				change_appeasement_positive = { CLASS = popular   AMOUNT = popular_appeasement_yearly_change }
				change_appeasement_positive = { CLASS = clergy  AMOUNT = clergy_appeasement_yearly_change }
			}
		}
		random_living_character = {
			initialize_global_election_terms = yes
		}
		if = {
			limit = { NOT = { has_global_variable = started_campaigns_running } }
			trigger_event = {
				on_action = campaigns_running
			}
		}
		every_valid_republic_holder = {
			limit = {
				house.var:titular_republic = {
					has_variable = current_dictatorship
					NOT = { has_variable = forced_dictatorship }
				}
				is_at_war = no
			}
			trigger_event = {
				id = dictatorship_events.1002
				days = 30
			}
		}
		every_independent_ruler = {
			primary_title = {
				every_in_de_facto_hierarchy = {
					limit = {
						tier = tier_county
					}
					remove_county_modifier = martial_law_modifier
				}
			}
		}
		every_valid_republic_holder = {
			if = {
				limit = {
					house.var:titular_republic = {
						has_variable = martial_law
						NOT = { has_variable = current_dictatorship }
					}
				}
				house.var:titular_republic = { remove_variable = martial_law }
			}
			if = {
				limit = {
					house.var:titular_republic = {
						has_variable = martial_law
						has_variable = current_dictatorship
						OR = {
							holder = { is_at_war = yes }
							has_variable = forced_dictatorship
						}
					}
				}
				primary_title = {
					every_in_de_facto_hierarchy = {
						limit = {
							tier = tier_county
							save_temporary_scope_as = temporary_title
							holder = { completely_controls = scope:temporary_title }
						}
						add_county_modifier = martial_law_modifier
					}
				}
				var:republic_head = { set_variable = martial_law }
			}
			if = {
				limit = {
					house.var:titular_republic = {
						has_variable = martial_law
						has_variable = current_dictatorship
						NAND = {
							holder = { is_at_war = yes }
							has_variable = forced_dictatorship
						}
					}
				}
				house.var:titular_republic = {
					remove_variable = martial_law
				}
			}
		}
		every_valid_potential_republic_holder = { set_up_elected_ruler_republic = yes }
		every_valid_republic_holder = {
			limit = { var:republic_head.republic_families_size_need > 0 }
			create_characters_for_republic = yes
		}
	}
	on_actions = {
		start_the_terms
		delay = { days = { 20 345 } }
		all_houses_maybe_propose_laws
	}
}

start_the_terms = {
	trigger = {
		NOT = { exists = global_var:set_up_global_election_terms }
	}
	effect = {
		set_global_variable = set_up_global_election_terms
	}
	on_actions = {
		delay = { years = 1 }
		one_year_elections
		delay = { years = 1 }
		two_year_elections
		delay = { years = 2 }
		four_year_elections
		delay = { years = 6 }
		ten_year_elections
		delay = { years = 10 }
		twenty_year_elections
	}
}

on_game_start = {
	on_actions = {
		prepare_republic_laws
		question_player
		set_up_the_republics
	}
}

set_up_the_republics = {
	effect = {
		if = {
			limit = { current_date >= 769.1.1 }
			culture:italian = { add_innovation = innovation_italian_republics }
			culture:roman = { add_innovation = innovation_italian_republics }
			culture:cisalpine = { add_innovation = innovation_italian_republics }
			culture:sardinian = { add_innovation = innovation_italian_republics }
			culture:sicilian = { add_innovation = innovation_italian_republics }
			culture:lombard = { add_innovation = innovation_italian_republics }
			culture:dalmatian_ce = { add_innovation = innovation_italian_republics }
			culture:maltese = { add_innovation = innovation_italian_republics }
			culture:neapolitan = { add_innovation = innovation_italian_republics }
			culture:tuscan_ce = { add_innovation = innovation_italian_republics }
			culture:venetian_ce = { add_innovation = innovation_italian_republics }
			culture:ligurian = { add_innovation = innovation_italian_republics }
		}
		#MB - Let's set the other innovations RES adds
		if = {
			limit = { current_date >= 1166.1.1 }
			culture:italian = { add_innovation = innovation_terraferma }
			culture:roman = { add_innovation = innovation_terraferma }
			culture:cisalpine = { add_innovation = innovation_terraferma }
			culture:sardinian = { add_innovation = innovation_terraferma }
			culture:sicilian = { add_innovation = innovation_terraferma }
			culture:lombard = { add_innovation = innovation_terraferma }
			culture:dalmatian_ce = { add_innovation = innovation_terraferma }
			culture:maltese = { add_innovation = innovation_terraferma }
			culture:neapolitan = { add_innovation = innovation_terraferma }
			culture:tuscan_ce = { add_innovation = innovation_terraferma }
			culture:venetian_ce = { add_innovation = innovation_terraferma }
			culture:ligurian = { add_innovation = innovation_terraferma }
		}
		
		if = {
			limit = { current_date >= 1204.1.1 }
			culture:italian = { add_innovation = innovation_republican_ideals }
			culture:roman = { add_innovation = innovation_republican_ideals }
			culture:cisalpine = { add_innovation = innovation_republican_ideals }
			culture:sardinian = { add_innovation = innovation_republican_ideals }
			culture:sicilian = { add_innovation = innovation_republican_ideals }
			culture:lombard = { add_innovation = innovation_republican_ideals }
			culture:dalmatian_ce = { add_innovation = innovation_republican_ideals }
			culture:maltese = { add_innovation = innovation_republican_ideals }
			culture:neapolitan = { add_innovation = innovation_republican_ideals }
			culture:tuscan_ce = { add_innovation = innovation_republican_ideals }
			culture:venetian_ce = { add_innovation = innovation_republican_ideals }
			culture:ligurian = { add_innovation = innovation_republican_ideals }
		}
		
		if = {
			limit = { current_date >= 1241.1.1 } #First parliament convened in 1215
			culture:english = { add_innovation = innovation_english_parliament }
		}
		
		if = {
			limit = { current_date >= 1285.1.1 } 
			culture:english = { add_innovation = innovation_parliamentary_ideals }
		}
	
		
		if = {
			limit = { current_date >= 1187.1.1
					  current_date <= 1268.1.1 }

			title:d_iceland = {
				holder = {
					set_up_senate_republic = yes
				}
			}
		}
		
		
		
		#MB
		
		#Pisa
		
		
		if = {
			limit = { current_date >= 1005.1.1
					  current_date <= 1059.1.1 }
			title:d_pisa = {
				holder = {
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					set_up_council_republic = yes
					#set_up_senate_republic = yes #Senate republics don't seem to work
				}
			}
		}
		
		if = {
			limit = { current_date >= 1060.1.1
					  current_date <= 1285.1.1 }
			title:k_pisa = {
				holder = {
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					set_up_council_republic = yes
					#set_up_senate_republic = yes #Senate republics don't seem to work
				}
			}
		}
		
		if = {
			limit = { current_date >= 1285.1.1 }
			title:d_pisa = {
				holder = {
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					set_up_council_republic = yes
					#set_up_senate_republic = yes #Senate republics don't seem to work
				}
			}
		}
		
		
		#Venice
		
		
		if = {
			limit = { current_date >= 800.1.1 }
			title:k_venice = {
				holder = {
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					set_up_council_republic = yes
					#set_up_senate_republic = yes #Senate republics don't seem to work
				}
			}
		}
		
		
		#Florence
		
		
		if = {
			limit = { current_date >= 1337.1.1 } #Actually 1115
			title:k_venice = {
				holder = {
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					set_up_council_republic = yes
					#set_up_senate_republic = yes #Senate republics don't seem to work
				}
			}
		}
		
		
		#Channel Isles
		
		
		if = {
			limit = { current_date >= 1065.1.1 }
			title:d_channel_islands = {
				holder = {
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					set_up_council_republic = yes
				}
			}
		}
		
		#Republic of Ancona - Life terms
		if = {
			limit = { current_date >= 1018.1.1 }
			title:d_ancona = {
				holder = {
				
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					
					set_up_council_republic = yes
				}
			}
			#title:d_ancona = {
			#	set_variable = council_government_republic #Senate would also probably work
			#	remove_variable = elected_ruler_republic
			#	remove_variable = senate_government_republic
			#	set_variable = council_approval_war_declaration
			#	set_variable = leaders_discretion_council_appointment
			#	set_variable = council_approval_imprisonment_rights
			#	set_variable = council_approval_title_revocation
			#	set_variable = council_approval_title_granting
			#	remove_variable = twenty_year_term
			#	set_variable = life_title_term
			#	
			#	set_variable = {
			#		name = nobility_appeasement
			#		value = 50
			#	}
			#	set_variable = {
			#		name = clergy_appeasement
			#		value = 50
			#	}
			#	set_variable = {
			#		name = popular_appeasement
			#		value = 50
			#	}
			#	republic_council_succesion = yes
			#}
		}
		#Republic of Gotland - 2 year terms
		if = {
			limit = { current_date >= 1187.1.1 }
			title:d_gotland = {
				holder = {
				
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					
					set_up_council_republic = yes
				}
			}

		}
		#Republic of Genoa - 1 year terms
		if = {
			limit = { current_date >= 1066.1.2 }
			title:d_genoa = {
		
				holder = {
				
					house = {
						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
					}
					
					set_up_elected_ruler_republic = yes
				}
				
			}
			#title:d_genoa = {
			#	set_variable = elected_ruler_republic 
			#	remove_variable = council_government_republic
			#	remove_variable = senate_government_republic
			#	remove_variable = bicameral_government_republic
			#	set_variable = one_year_term
			#	
			#	set_variable = elected_ruler_republic
			#	remove_variable = life_title_term
			#
			#}
		}
		
		#
		
		#if = {
		#	
		#	limit = {
		#		game_start_date >= 1125.1.1
		#	}		
		#	title:d_siena_republic = {
		#		holder = {
		#			
		#			house = {
		#				if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
		#				if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
		#			}
		#			
		#			set_up_council_republic = yes
		#			
		#		}
		#
		#	}
		#	
		#	
		#}
		

		every_valid_potential_republic_holder = { set_up_elected_ruler_republic = yes }
	}
}


#set_up_the_republics = {
#
#	effect = {
#		if = {
#			limit = { current_date >= 769.1.1 }
#			culture:italian = { add_innovation = innovation_italian_republics }
#			culture:roman = { add_innovation = innovation_italian_republics }
#			culture:cisalpine = { add_innovation = innovation_italian_republics }
#			culture:sardinian = { add_innovation = innovation_italian_republics }
#			culture:sicilian = { add_innovation = innovation_italian_republics }
#			culture:lombard = { add_innovation = innovation_italian_republics }
#			culture:dalmatian_ce = { add_innovation = innovation_italian_republics }
#			culture:maltese = { add_innovation = innovation_italian_republics }
#			culture:neapolitan = { add_innovation = innovation_italian_republics }
#			culture:tuscan_ce = { add_innovation = innovation_italian_republics }
#			culture:venetian_ce = { add_innovation = innovation_italian_republics }
#			culture:ligurian = { add_innovation = innovation_italian_republics }
#		}
#		#MB - Let's set the other innovations RES adds
#		if = {
#			limit = { current_date >= 1166.1.1 }
#			culture:italian = { add_innovation = innovation_terraferma }
#			culture:roman = { add_innovation = innovation_terraferma }
#			culture:cisalpine = { add_innovation = innovation_terraferma }
#			culture:sardinian = { add_innovation = innovation_terraferma }
#			culture:sicilian = { add_innovation = innovation_terraferma }
#			culture:lombard = { add_innovation = innovation_terraferma }
#			culture:dalmatian_ce = { add_innovation = innovation_terraferma }
#			culture:maltese = { add_innovation = innovation_terraferma }
#			culture:neapolitan = { add_innovation = innovation_terraferma }
#			culture:tuscan_ce = { add_innovation = innovation_terraferma }
#			culture:venetian_ce = { add_innovation = innovation_terraferma }
#			culture:ligurian = { add_innovation = innovation_terraferma }
#		}
#		
#		if = {
#			limit = { current_date >= 1204.1.1 }
#			culture:italian = { add_innovation = innovation_republican_ideals }
#			culture:roman = { add_innovation = innovation_republican_ideals }
#			culture:cisalpine = { add_innovation = innovation_republican_ideals }
#			culture:sardinian = { add_innovation = innovation_republican_ideals }
#			culture:sicilian = { add_innovation = innovation_republican_ideals }
#			culture:lombard = { add_innovation = innovation_republican_ideals }
#			culture:dalmatian_ce = { add_innovation = innovation_republican_ideals }
#			culture:maltese = { add_innovation = innovation_republican_ideals }
#			culture:neapolitan = { add_innovation = innovation_republican_ideals }
#			culture:tuscan_ce = { add_innovation = innovation_republican_ideals }
#			culture:venetian_ce = { add_innovation = innovation_republican_ideals }
#			culture:ligurian = { add_innovation = innovation_republican_ideals }
#		}
#		
#		if = {
#			limit = { current_date >= 1241.1.1 } #First parliament convened in 1215
#			culture:english = { add_innovation = innovation_english_parliament }
#		}
#		
#		if = {
#			limit = { current_date >= 1285.1.1 } 
#			culture:english = { add_innovation = innovation_parliamentary_ideals }
#		}
#		
#		
#		every_ruler = { #Was every_independent_ruler which made vassal republics not work. Let's see if it makes something else explode
#			limit = { holds_valid_merchant_republic = yes }
#			add_family_to_republic_families = yes
#			every_vassal = { 
#				limit = { exists = house is_house_head = yes NOT = { has_government = theocracy_government } }
#				add_family_to_republic_families = yes
#			}
#			every_courtier = {
#				limit = {
#					exists = house
#					is_house_head = yes
#					#culture.heritage = liege_or_court_owner.culture.heritage #Disabled since it prevents multi cultural republics such as Ancona (Greeks and Italians) and Ragusa (Dalmatians and Croats)
#				}
#				add_family_to_republic_families = yes
#			}
#			every_courtier_away = { #To catch a courtier who decides they want to be visiting a court even when employed
#				limit = {
#					exists = house
#					is_house_head = yes
#					#culture_group = liege_or_court_owner.culture_group #Disabled since it prevents multi cultural republics such as Ancona (Greeks and Italians) and Ragusa (Dalmatians and Croats)
#				}
#				add_family_to_republic_families = yes
#			}
#		}
#		
#		#The set variables no longer may be needed
#		
#		if = {
#			#Duchy formed in 1000
#			limit = {
#				game_start_date >= 1018.1.1
#			}		
#			title:d_pisa = {
#				holder = {
#						change_variable = {
#							name = family_prestige
#							add = value_to_add_amount
#						}
#					}
#					set_up_council_republic = yes
#				}
#			}
#		if = {
#			limit = { current_date >= 1066.1.1 }
#			title:k_pisa = {		
#				holder = {
#					house = {
#						if = { limit = { exists = var:family_prestige } change_variable = { name = family_prestige add = value_to_add_amount } }
#						if = { limit = { NOT = { exists = var:family_prestige } } set_variable = { name = family_prestige add = value_to_add_amount } }
#					}
#					set_up_council_republic = yes
#				}
#				set_variable = council_government_republic
#				remove_variable = elected_ruler_republic
#				remove_variable = senate_government_republic
#				set_variable = council_approval_war_declaration
#				set_variable = leaders_discretion_council_appointment
#				set_variable = council_approval_imprisonment_rights
#				set_variable = council_approval_title_revocation
#				set_variable = council_approval_title_granting
#				set_variable = twenty_year_term
#				set_variable = {
#					name = nobility_appeasement
#					value = 50
#				}
#				set_variable = {
#					name = clergy_appeasement
#					value = 50
#				}
#				set_variable = {
#					name = popular_appeasement
#					value = 50
#				}
#				republic_council_succesion = yes
#			}
#			title:d_iceland = {
#				holder = {
#					set_up_senate_republic = yes
#				}
#			}
#		}
#		#MB
#		#Republic of Ancona - Life terms
#		if = {
#			limit = { current_date >= 1018.1.1 }
#			title:d_ancona = {
#				holder = {
#					set_up_council_republic = yes
#				}
#			}
#			title:d_ancona = {
#				set_variable = council_government_republic #Senate would also probably work
#				remove_variable = elected_ruler_republic
#				remove_variable = senate_government_republic
#				set_variable = council_approval_war_declaration
#				set_variable = leaders_discretion_council_appointment
#				set_variable = council_approval_imprisonment_rights
#				set_variable = council_approval_title_revocation
#				set_variable = council_approval_title_granting
#				remove_variable = twenty_year_term
#				set_variable = life_title_term
#				
#				set_variable = {
#					name = nobility_appeasement
#					value = 50
#				}
#				set_variable = {
#					name = clergy_appeasement
#					value = 50
#				}
#				set_variable = {
#					name = popular_appeasement
#					value = 50
#				}
#				republic_council_succesion = yes
#			}
#		}
#		#Republic of Gotland - 2 year terms
#		if = {
#			limit = { current_date >= 1187.1.1 }
#			title:d_gotland = {
#				holder = {
#					set_up_council_republic = yes
#				}
#			}
#			title:d_gotland = {
#				set_variable = council_government_republic
#				remove_variable = elected_ruler_republic
#				remove_variable = senate_government_republic
#				set_variable = council_approval_war_declaration
#				set_variable = leaders_discretion_council_appointment
#				set_variable = council_approval_imprisonment_rights
#				set_variable = council_approval_title_revocation
#				set_variable = council_approval_title_granting
#				set_variable = two_year_term
#				set_variable = {
#					name = nobility_appeasement
#					value = 50
#				}
#				set_variable = {
#					name = clergy_appeasement
#					value = 50
#				}
#				set_variable = {
#					name = popular_appeasement
#					value = 50
#				}
#				republic_council_succesion = yes
#			}
#			title:d_iceland = {
#				holder = {
#					set_up_senate_republic = yes
#				}
#			}
#		}
#		#Republic of Genoa - 1 year terms
#		if = {
#			limit = { current_date >= 1066.1.2 }
#			title:d_genoa = {
#				holder = {
#					set_up_elected_ruler_republic = yes
#				}
#			}
#			title:d_genoa = {
#				set_variable = elected_ruler_republic 
#				remove_variable = council_government_republic
#				remove_variable = senate_government_republic
#				remove_variable = bicameral_government_republic
#				set_variable = one_year_term
#				
#				set_variable = elected_ruler_republic
#				remove_variable = life_title_term
#		
#			}
#		}
#		
#		every_valid_potential_republic_holder = { set_up_elected_ruler_republic = yes }
#		
#	}
#}


question_player = {
	effect = {
		if = { limit = { has_game_rule = play_elected_rulers } set_global_variable = play_republic_leaders }
		if = { limit = { has_game_rule = play_patricians } set_global_variable = play_house_heads }
	}
	on_actions = {
		delay = { days = 1 }
		question_player_if_needed
	}
}

question_player_if_needed = {
	effect = {
		if = {
			limit = {
				NOT = {
					exists = global_var:play_house_heads
					exists = global_var:play_republic_leaders
				}
			}
			random_player = {
				trigger_event = republic_question_events.1001
			}
		}
	}
}

prepare_republic_laws = {
	effect = {
		all_council_laws = yes
		all_senate_laws = yes
		all_elected_ruler_laws = yes
		all_bicameral_laws = yes
		every_valid_council_republic_holder = {
			var:republic_head = {
				specific_post_appeasement = { CLASS = nobility }
				specific_post_appeasement = { CLASS = clergy }
				specific_post_appeasement = { CLASS = popular }
			}
		}
	}
}

# all_houses_maybe_propose_laws = {
# 	effect = {
# 		every_living_character = {
# 			limit = {
# 				is_house_head = yes
# 				house = {
# 					exists = var:titular_republic
# 					var:titular_republic = { save_temporary_scope_as = titular_republic }
# 				}
# 				scope:titular_republic = {
# 					holder = {
# 						republic_has_senate_form = yes
# 					}
# 				}
# 				is_ai = yes
# 			}
# 			ai_chance_to_propose_law = { LAW = senate_vote_war_declaration }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_war_declaration }
# 			ai_chance_to_propose_law = { LAW = senate_vote_council_appointment }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_council_appointment }
# 			ai_chance_to_propose_law = { LAW = senate_vote_imprisonment_rights }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_imprisonment_rights }
# 			ai_chance_to_propose_law = { LAW = senate_vote_title_revocation }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_title_revocation }
# 			ai_chance_to_propose_law = { LAW = senate_vote_title_granting }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_title_granting }
# 			ai_chance_to_propose_law = { LAW = life_title_term }
# 			ai_chance_to_propose_law = { LAW = twenty_year_term }
# 			ai_chance_to_propose_law = { LAW = ten_year_term }
# 			ai_chance_to_propose_law = { LAW = four_year_term }
# 			ai_chance_to_propose_law = { LAW = two_year_term }
# 			ai_chance_to_propose_law = { LAW = one_year_term }
# 		}

# 		every_living_character = {
# 			limit = {
# 				is_house_head = yes
# 				house = {
# 					exists = var:titular_republic
# 					var:titular_republic = { save_temporary_scope_as = titular_republic }
# 				}
# 				scope:titular_republic = {
# 					holder = {
# 						republic_has_council_form = yes
# 					}
# 				}
# 				is_ai = yes
# 			}
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_war_declaration }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_council_appointment }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_imprisonment_rights }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_title_revocation }
# 			ai_chance_to_propose_law = { LAW = leaders_discretion_title_granting }
# 			ai_chance_to_propose_law = { LAW = life_title_term }
# 			ai_chance_to_propose_law = { LAW = twenty_year_term }
# 			ai_chance_to_propose_law = { LAW = ten_year_term }
# 			ai_chance_to_propose_law = { LAW = four_year_term }
# 			ai_chance_to_propose_law = { LAW = two_year_term }
# 			ai_chance_to_propose_law = { LAW = one_year_term }
# 			random_list = {
# 				0 = {
# 					senate_vote_war_declaration_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								var:republic_head = {
# 									exists = var:council_approval_war_declaration
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									var:republic_head = {
# 										exists = var:council_approval_war_declaration
# 									}
# 								}
# 							}
# 						}
# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						var:republic_head = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_war_declaration } }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no exists = liege_or_court_owner}
# 						liege_or_court_owner = { var:republic_head = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_war_declaration } } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					senate_vote_council_appointment_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:council_approval_council_appointment
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:council_approval_council_appointment
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_council_appointment } }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no exists = liege_or_court_owner}
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_council_appointment } } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					senate_vote_imprisonment_rights_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:council_approval_imprisonment_rights
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:council_approval_imprisonment_rights
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_imprisonment_rights } }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no exists = liege_or_court_owner}
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_imprisonment_rights } } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}

# 			random_list = {
# 				0 = {
# 					senate_vote_title_revocation_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:council_approval_title_revocation
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:council_approval_title_revocation
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_title_revocation } }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no exists = liege_or_court_owner}
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_title_revocation } } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					senate_vote_title_granting_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:council_approval_title_granting
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:council_approval_title_granting
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_title_granting } }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no exists = liege_or_court_owner}
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:council_approval_title_granting } } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 		}

# 		every_living_character = {
# 			limit = {
# 				is_house_head = yes
# 				house = {
# 					exists = var:titular_republic
# 					var:titular_republic = { save_temporary_scope_as = titular_republic }
# 				}
# 				scope:titular_republic = {
# 					holder = {
# 						republic_has_elected_ruler_form = yes
# 					}
# 				}
# 				is_ai = yes
# 			}
# 			random_list = {
# 				0 = {
# 					life_title_term_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:life_title_term
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:life_title_term
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:life_title_term } trigger_elected_ruler_quick_election = yes }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no exists = liege_or_court_owner }
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:life_title_term } trigger_elected_ruler_quick_election = yes } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					twenty_year_term_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:twenty_year_term
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:twenty_year_term
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:twenty_year_term } trigger_elected_ruler_quick_election = yes }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no }
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:twenty_year_term } trigger_elected_ruler_quick_election = yes } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					ten_year_term_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:ten_year_term
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:ten_year_term
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:ten_year_term } trigger_elected_ruler_quick_election = yes }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no }
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:ten_year_term } trigger_elected_ruler_quick_election = yes } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					four_year_term_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:four_year_term
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:four_year_term
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:four_year_term } trigger_elected_ruler_quick_election = yes }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no }
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:four_year_term } trigger_elected_ruler_quick_election = yes } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					two_year_term_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:two_year_term
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:two_year_term
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:two_year_term } trigger_elected_ruler_quick_election = yes }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no }
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:two_year_term } trigger_elected_ruler_quick_election = yes } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 			random_list = {
# 				0 = {
# 					one_year_term_propose_modifier = yes

# 					modifier = {
# 						OR = {
# 							AND = {
# 								is_independent_ruler = yes
# 								primary_title = {
# 									exists = var:one_year_term
# 								}
# 							}
# 							AND = {
# 								is_independent_ruler = no
# 								exists = liege_or_court_owner
# 								liege_or_court_owner = {
# 									primary_title = {
# 										exists = var:one_year_term
# 									}
# 								}
# 							}
# 						}

# 						add = -10000
# 					}
# 					if = {
# 						limit = { is_independent_ruler = yes }
# 						primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:one_year_term } trigger_elected_ruler_quick_election = yes }
# 					}
# 					if = {
# 						limit = { is_independent_ruler = no }
# 						liege_or_court_owner = { primary_title = { add_to_variable_list = { name = proposed_laws_list target = flag:one_year_term } trigger_elected_ruler_quick_election = yes } }
# 					}
# 				}
# 				10000 = {
# 				}
# 			}
# 		}
# 	}
# }

one_year_elections = {
	effect = {
		every_valid_republic_holder = {
			limit = { var:republic_head = { var:term_limits_law = 6 NOT = { exists = var:current_dictatorship } } }
			var:republic_head = {
				republic_succession = yes
				republic_council_succesion = yes
			}
		}
	}
	on_actions = {
		delay = { years = 1 }
		one_year_elections
	}
}

two_year_elections = {
	effect = {
		every_valid_republic_holder = {
			limit = { var:republic_head = { var:term_limits_law = 7 NOT = { exists = var:current_dictatorship } } }
			var:republic_head = {
				republic_succession = yes
				republic_council_succesion = yes
			}
		}
	}
	on_actions = {
		delay = { years = 2 }
		two_year_elections
	}
}

four_year_elections = {
	effect = {
		every_valid_republic_holder = {
			limit = { var:republic_head = { var:term_limits_law = 8 NOT = { exists = var:current_dictatorship } } }
			var:republic_head = {
				republic_succession = yes
				republic_council_succesion = yes
			}
		}
		every_valid_republic_holder = {
			var:republic_head = {
				republic_senator_elections = yes
			}
		}
		every_living_character = {
			limit = { is_house_head = yes exists = house.var:titular_republic exists = house.var:family_prestige }
			house = {
				if = {
					limit = { var:family_prestige >= 50 }
					change_variable = {
						name = family_prestige
						add = -50
					}
				}
				if = {
					limit = { var:family_prestige <= -50 }
					change_variable = {
						name = family_prestige
						add = 50
					}
				}
			}
		}
	}
	on_actions = {
		delay = { years = 4 }
		four_year_elections
	}
}

ten_year_elections = {
	effect = {
		every_valid_republic_holder = {
			limit = { var:republic_head = { var:term_limits_law = 9 NOT = { exists = var:current_dictatorship } } }
			var:republic_head = {
				republic_succession = yes
				republic_council_succesion = yes
			}
		}
	}
	on_actions = {
		delay = { years = 10 }
		ten_year_elections
	}
}

twenty_year_elections = {
	effect = {
		every_valid_republic_holder = {
			limit = { var:republic_head = { var:term_limits_law = 10 NOT = { exists = var:current_dictatorship } } }
			var:republic_head = {
				republic_succession = yes
				republic_council_succesion = yes
			}
		}
	}
	on_actions = {
		delay = { years = 20 }
		twenty_year_elections
	}
}

campaigns_running = {
	effect = {
		if = {
			limit = { NOT = { has_global_variable = started_campaigns_running } }
			set_global_variable = started_campaigns_running
		}
		every_valid_propogandist = {
			house = {
				save_scope_as = your_house
				every_in_list = {
					variable = propoganda_campaigns_list
					limit = { save_temporary_scope_as = house_testing NOT = { scope:your_house.var:titular_republic = { is_target_in_variable_list = { name = republic_families_list target = scope:house_testing } } } }
					save_scope_as = house_remove_propo_campaigns
					scope:your_house = {
						remove_list_variable = { name = propoganda_campaigns_list target = scope:house_remove_propo_campaigns }
					}
				}
				every_in_list = {
					variable = propoganda_campaigns_list
					house_head = {
						save_scope_as = this_guy
						send_interface_message = {
							left_icon = scope:this_guy
							title = propoganda_campaign_gains
							custom_description = {
								text = effect_change_family_influence_positive
								value = 6
								change_variable = {
									name = family_prestige
									add = 6
								}
							}
						}
					}
				}
			}
		}
		every_valid_smearer = {
			house = {
				save_scope_as = your_house
				every_in_list = {
					variable = smear_campaigns_list
					limit = { save_temporary_scope_as = house_testing NOT = { scope:your_house.var:titular_republic = { is_target_in_variable_list = { name = republic_families_list target = scope:house_testing } } } }
					save_scope_as = house_remove_smear_campaigns
					scope:your_house = {
						remove_list_variable = { name = smear_campaigns_list target = scope:house_remove_smear_campaigns }
					}
				}
				every_in_list = {
					variable = smear_campaigns_list
					house_head = {
						save_scope_as = this_guy
						send_interface_message = {
							left_icon = scope:this_guy
							title = smear_campaign_gains
							custom_description = {
								text = effect_change_family_influence_negative
								value = 6
								change_variable = {
									name = family_prestige
									subtract = 6
								}
							}
						}
					}
				}
			}
		}
	}
	on_actions = {
		delay = { months = 1 }
		campaigns_running
	}
}