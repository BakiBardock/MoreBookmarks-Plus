# root: The province in which the building was completed
on_building_completed = {
	on_actions = {
		slots_check_on_actions
	}
}

on_game_start_after_lobby = {
	on_actions = {
		set_provinces_on_actions
	}
}


realm_maintenance_quarterly_pulse = {
	on_actions = {
		update_provinces_on_actions
	}
}

update_provinces_on_actions = {
	effect = {
		if = {
			limit = { 
				NOT = { 
					is_target_in_global_variable_list = {
						name = unavailable_unique_decisions
						target = flag:populated_provinces
					}
				}
			}
			every_ruler = {
				limit = {
					is_ai = no
					NOT = { has_character_flag = populated_provinces_done }
				}
				trigger_event = populate_province.001
			}
		}
	}
}

#Sets province buildings

set_provinces_on_actions = {
	effect = {
		if = {
			limit = { 
				NOT = { 
					is_target_in_global_variable_list = {
						name = unavailable_unique_decisions
						target = flag:populated_provinces
					}
				}
				has_game_rule = do_populate
			}
			 
			#Commented out titles I manually did as it's easier to just edit the province rather than make the different variations for sieges here
			title:b_cairo.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			#title:b_constantinople.title_province = {
			#	remove_building = common_tradeport_01
			#	remove_building = common_tradeport_02
			#	add_building = castle_05
			#	add_building = cow_harbor_byzantion_01
			#}
			title:b_alexandria.title_province = {
				add_building = castle_05
				remove_building = cow_lighthouse_alexandria_01
				add_special_building = cow_lighthouse_alexandria_01
				add_building_slot = 1
			}
			title:b_cordoba.title_province = {
				remove_building = curtain_walls_01
				remove_building = regimental_grounds_01
				add_building = castle_05
				add_building = cow_university_cordoba_01
				add_building = cow_palace_cordoba_01
					add_building_slot = 1
			}
			#title:b_baghdad.title_province = {
			#	add_building = castle_05
			#}
			title:b_roma.title_province = {
				remove_building = curtain_walls_01
				remove_building = curtain_walls_02
				add_building = castle_05
				add_building = cow_palace_roma_01
			}
			
			title:b_paris.title_province = {
				add_building = castle_05
					add_building_slot = 1
			}
			title:b_venezia.title_province = {
				add_building = castle_05
					add_building_slot = 1
			}
			title:b_antiocheia.title_province = {
				add_building = castle_05
				add_building = cow_grand_fortress_antiocheia_01
				add_building_slot = 1
			}
			title:c_suzhou.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_anahilapataka.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_varanasi.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_chunar.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_preslav.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_thessaloniki.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_sevilla.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_mainz.title_province = {
				set_holding_type = castle_holding
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_milano.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_napoli.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_toledo.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_regensburg.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_verona.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_cologne.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_granada.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_trier.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_metz.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_london.title_province = {
				add_building = castle_05
				add_building_slot = 1
			}
			title:b_kanyakubja.title_province = {
				add_building = castle_05
				add_building_slot = 1
				add_special_building = cow_annapurna_temple_01
			}
			title:b_panaji.title_province = {
				add_building = castle_05
				add_special_building = cow_durgardi_fort_01
				add_building_slot = 1
			}
			if = {
				limit = { current_date < 1066.1.1 }
				
			}
			if = {
				limit = { current_date >= 1066.1.1 }
				title:b_kiev.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_fes.title_province = {
					add_building = castle_05
					add_building_slot = 1
					add_special_building = cow_zawiya_01
				}
				title:b_marrakesh.title_province = {
					add_building = castle_05
					add_building_slot = 1
					add_special_building = cow_city_gates_01
				}
				title:b_dhara.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_suzhou.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_salerno.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_speyer.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_firenze.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_rouen.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_bruges.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				title:b_indraprastha.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				
				#MB
				
				title:b_katak.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				
				title:b_pagan.title_province = {
					add_building = castle_05
					add_building_slot = 1
					add_building = cereal_fields_01
					add_building = barracks_01
				}
				
				title:b_lahur.title_province = {
					add_building = castle_05
					add_building_slot = 1
				}
				
			}
			
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:populated_provinces
			}
		}
		if = {
			limit = {
				has_game_rule = dont_populate
			}
			add_to_global_variable_list = {
				name = unavailable_unique_decisions
				target = flag:populated_provinces
			}
		}
	}
}

slots_check_on_actions = {
	effect = {
		root = {
				if = {
					limit = {
						has_building = castle_05
						building_slots = 5
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
				else_if = {
					limit = {
						has_building = castle_06
						building_slots = 6
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
				else_if = {
					limit = {
						has_building = castle_07
						building_slots = 7
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
				else_if = {
					limit = {
						has_building = tribe_03
						building_slots = 5
						building_common_tradeport_requirement_terrain = yes
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
				if = {
					limit = {
						has_building = city_05
						building_slots = 4
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
				else_if = {
					limit = {
						has_building = city_06
						building_slots = 5
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
				else_if = {
					limit = {
						has_building = city_07
						building_slots = 6
					}
					save_scope_as = current_province
					county.holder = {
						send_interface_toast = {
							type = event_generic_good
							title = city_gained_building_slots
							left_icon = scope:current_province

							scope:current_province = { add_building_slot = 1 }
						}
					}
				}
		}
	}
}